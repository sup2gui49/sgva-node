<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGVA - Sistema de Gest√£o de Vendas Adapt√°vel</title>
    <link rel="stylesheet" href="style.css">
    <link id="bootstrap-css" rel="stylesheet" href="vendor/bootstrap/bootstrap.min.css" data-cdn="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" data-offline-group="core">
    <link id="bootstrap-icons" rel="stylesheet" href="vendor/bootstrap-icons/bootstrap-icons.css" data-cdn="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" data-offline-group="icons">
    <link rel="stylesheet" href="offline.css" id="fallback-css" data-offline-style="core" disabled>
    <link rel="stylesheet" href="offline-icons.css" id="fallback-icons" data-offline-style="icons" disabled>
    <link rel="icon" type="image/x-icon" href="LogGuiMont_1.ico">
    <script src="js/offline-assets.js"></script>
    <script>
        AssetLoader.loadScript(
            'https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js',
            'vendor/chartjs/chart.umd.min.js',
            { target: 'head' }
        );
    </script>
    <style>
        .product-filter {
            margin: 15px 0;
        }

        .product-filter-input {
            width: 300px;
            padding: 10px;
        }

        .product-filter-select {
            padding: 10px;
        }

        .table-scroll {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .table-scroll table {
            min-width: 720px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Dashboard -->
        <div id="dashboard-section" class="section active">
            <nav class="navbar">
                <h2>SGVA Dashboard</h2>
                <div class="user-info">
                    <span id="user-name"></span>
                    <button onclick="window.location.href='index.html'" style="margin-right: 10px; background: #6c757d;">
                        ‚¨ÖÔ∏è Voltar ao Painel
                    </button>
                    <button onclick="logout()">Sair</button>
                </div>
            </nav>

            <div class="menu">
                <button class="menu-btn active" onclick="showPage('dashboard')">üìä Dashboard</button>
                <button class="menu-btn" onclick="showPage('categorias')">üè∑Ô∏è Categorias</button>
                <button class="menu-btn" onclick="showPage('produtos')">üì¶ Produtos</button>
                <button class="menu-btn" onclick="showPage('vendas')">üí∞ Vendas</button>
                <button class="menu-btn" onclick="showPage('financeiro')">üíµ Financeiro</button>
                <button class="menu-btn" onclick="showPage('configuracoes')">‚öôÔ∏è Configura√ß√µes</button>
            </div>

            <!-- Dashboard Home -->
            <div id="page-dashboard" class="page active">
                <h2>Dashboard Financeiro</h2>
                <div id="dashboard-cards" class="cards"></div>
                <div id="dashboard-offline-banner" class="offline-banner" style="display:none;"></div>
                
                <!-- Gr√°ficos -->
                <div id="dashboard-charts" class="charts-container">
                    <div class="chart-box">
                        <h3>Receitas vs Despesas</h3>
                        <canvas id="chart-receita-despesa"></canvas>
                    </div>
                    <div class="chart-box">
                        <h3>Despesas por Categoria</h3>
                        <canvas id="chart-despesas-categoria"></canvas>
                    </div>
                    <div class="chart-box">
                        <h3>Evolu√ß√£o Mensal</h3>
                        <canvas id="chart-evolucao"></canvas>
                    </div>
                    <div class="chart-box">
                        <h3>Produtos e Servicos Mais Vendidos</h3>
                        <canvas id="chart-produtos"></canvas>
                    </div>
                </div>
            </div>

            <!-- Produtos -->
            <div id="page-produtos" class="page">
                <h2>Gest√£o de Produtos</h2>
                <button onclick="showAddProduct()">‚ûï Novo Produto</button>
                <button onclick="loadProducts()">üîÑ Atualizar</button>
                
                <div class="product-filter">
                    <input type="text" id="filter-produto" class="product-filter-input" placeholder="üîç Buscar produto..." onkeyup="filterProducts()" />
                    <select id="filter-categoria" class="product-filter-select" onchange="filterProducts()" aria-label="Filtrar por categoria">
                        <option value="">Todas Categorias</option>
                        <!-- Categorias carregadas dinamicamente via JavaScript -->
                    </select>
                </div>
                
                <div id="add-product-form" class="form-card" style="display:none;">
                    <h3>Adicionar Produto</h3>
                    <input type="text" id="prod-nome" placeholder="Nome do Produto" />
                    
                    <label for="produto-categoria">Categoria Fiscal *</label>
                    <select id="produto-categoria" required>
                        <option value="">Selecione uma categoria</option>
                        <!-- Categorias carregadas dinamicamente via JavaScript -->
                    </select>
                    <div class="iva-preview" id="iva-preview" style="display:none;">
                        <small><i class="fas fa-info-circle"></i> <strong>IVA:</strong> <span id="iva-taxa">14%</span> - <span id="iva-tipo">Produto</span></small>
                    </div>
                    
                    <input type="number" id="prod-custo" placeholder="Custo Unit√°rio (KZ)" step="0.01" />
                    <input type="number" id="prod-preco" placeholder="Pre√ßo de Venda (KZ)" step="0.01" />
                    <input type="number" id="prod-estoque" placeholder="Estoque Inicial" />
                    <input type="number" id="prod-estoque-minimo" placeholder="Estoque M√≠nimo" value="10" />
                    <button onclick="addProduct()">Salvar</button>
                    <button onclick="hideAddProduct()">Cancelar</button>
                </div>
                
                <div id="produtos-list"></div>
            </div>

            <!-- Categorias -->
            <div id="page-categorias" class="page">
                <h2>üè∑Ô∏è Gest√£o de Categorias Fiscais</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="showCategoriasTab('produtos')">Categorias de Produtos</button>
                    <button class="tab" onclick="showCategoriasTab('despesas')">Categorias de Despesas</button>
                    <button class="tab" onclick="showCategoriasTab('estatisticas')">Estat√≠sticas</button>
                </div>

                <!-- Categorias de Produtos -->
                <div id="categorias-produtos" class="tab-content active">
                    <div class="action-buttons">
                        <button class="btn-primary" onclick="categoriasManager.mostrarModalCategoriaProduto()">
                            ‚ûï Nova Categoria de Produto
                        </button>
                        <button class="btn-secondary" onclick="categoriasManager.carregarCategorias()">
                            üîÑ Atualizar
                        </button>
                    </div>

                    <div class="info-box">
                        <h4>üìã Categorias de Produtos e Servi√ßos</h4>
                        <p>Configure as categorias fiscais dos seus produtos. O IVA ser√° calculado automaticamente baseado na categoria:</p>
                        <ul>
                            <li><strong>0% (Isento)</strong>: Produtos alimentares b√°sicos, medicamentos, livros escolares</li>
                            <li><strong>7%</strong>: Produtos alimentares gerais, bebidas n√£o alco√≥licas</li>
                            <li><strong>14%</strong>: Demais produtos e servi√ßos (padr√£o Angola)</li>
                        </ul>
                    </div>

    <div class="table-responsive table-scroll">
                    <table id="tabela-categorias-produtos" class="data-table">
                        <thead>
                            <tr>
                                <th>Nome da Categoria</th>
                                <th>Tipo</th>
                                <th>Taxa IVA</th>
                                <th>Produtos</th>
                                <th>Descri√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados carregados via JavaScript -->
                        </tbody>
                    </table>
    </div>
                </div>

                <!-- Categorias de Despesas -->
                <div id="categorias-despesas" class="tab-content">
                    <div class="action-buttons">
                        <button class="btn-primary" onclick="categoriasManager.mostrarModalCategoriaDespesa()">
                            ‚ûï Nova Categoria de Despesa
                        </button>
                        <button class="btn-secondary" onclick="categoriasManager.carregarCategorias()">
                            üîÑ Atualizar
                        </button>
                    </div>

                    <div class="info-box">
                        <h4>üíº Categorias de Despesas</h4>
                        <p>Classifique suas despesas para controle fiscal e c√°lculo correto do IRT:</p>
                        <ul>
                            <li><strong>Dedut√≠veis IRT</strong>: Sal√°rios, aluguel, energia, material de escrit√≥rio</li>
                            <li><strong>N√£o Dedut√≠veis</strong>: Despesas pessoais, alguns impostos</li>
                        </ul>
                    </div>

    <div class="table-responsive table-scroll">
                    <table id="tabela-categorias-despesas" class="data-table">
                        <thead>
                            <tr>
                                <th>Nome da Categoria</th>
                                <th>C√≥digo Fiscal</th>
                                <th>Dedut√≠vel IRT</th>
                                <th>Descri√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados carregados via JavaScript -->
                        </tbody>
                    </table>
    </div>
                </div>

                <!-- Estat√≠sticas -->
                <div id="categorias-estatisticas" class="tab-content">
                    <div id="stats-cards" class="cards">
                        <!-- Cards de estat√≠sticas carregados via JavaScript -->
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-box">
                            <h3>Distribui√ß√£o por Taxa de IVA</h3>
                            <canvas id="chart-iva-distribuicao"></canvas>
                        </div>
                        <div class="chart-box">
                            <h3>Produtos vs Servi√ßos</h3>
                            <canvas id="chart-produtos-servicos"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vendas -->
            <div id="page-vendas" class="page">
                <h2>Registro de Vendas</h2>
                <button onclick="showNewSale()">‚ûï Nova Venda</button>
                
                <div id="new-sale-form" class="form-card" style="display:none;">
                    <h3>Registrar Venda</h3>
                    
                    <label for="sale-cliente-nome">Nome do Cliente:</label>
                    <input type="text" id="sale-cliente-nome" placeholder="Digite o nome do cliente" />
                    
                    <select id="sale-produto"></select>
                    <input type="number" id="sale-quantidade" placeholder="Quantidade" />
                    <button onclick="addItemToSale()">Adicionar Item</button>
                    
                    <div id="sale-items"></div>
                    
                    <input type="number" id="sale-desconto" placeholder="Desconto (KZ)" step="0.01" />
                    <div class="iva-info">
                        <p><i class="fas fa-info-circle"></i> <strong>IVA Autom√°tico:</strong> O IVA ser√° calculado automaticamente baseado na categoria fiscal de cada produto</p>
                        <small>‚Ä¢ Produtos alimentares b√°sicos, medicamentos: 0% (Isento)<br>
                               ‚Ä¢ Produtos alimentares gerais: 7%<br>  
                               ‚Ä¢ Demais produtos e servi√ßos: 14%</small>
                    </div>
                    <select id="sale-pagamento">
                        <option value="dinheiro">Dinheiro</option>
                        <option value="multicaixa">Multicaixa</option>
                        <option value="transferencia">Transfer√™ncia</option>
                    </select>
                    <button onclick="finalizeSale()">Finalizar Venda</button>
                    <button onclick="hideNewSale()">Cancelar</button>
                </div>
                
                <div id="vendas-list"></div>
            </div>

            <!-- Financeiro -->
            <div id="page-financeiro" class="page">
                <h2>Gest√£o Financeira</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="showFinanceiroTab('dre')">DRE</button>
                    <button class="tab" onclick="showFinanceiroTab('capital')">Capital de Giro</button>
                    <button class="tab" onclick="showFinanceiroTab('precificacao')">Precifica√ß√£o</button>
                    <button class="tab" onclick="showFinanceiroTab('despesas')">Despesas</button>
                </div>
                
                <div id="financeiro-dre" class="tab-content active"></div>
                <div id="financeiro-capital" class="tab-content"></div>
                <div id="financeiro-precificacao" class="tab-content"></div>
                <div id="financeiro-despesas" class="tab-content"></div>
            </div>

            <!-- Folha de Pagamento -->
            <div id="page-configuracoes" class="page">
                <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>
                <p class="text-muted">Acesse os m√≥dulos de configura√ß√£o do sistema</p>
                
                <div class="row mt-4">
                    <div class="col-md-4 mb-3">
                        <div class="card" style="cursor: pointer; transition: all 0.3s;" onclick="window.location.href='configuracoes.html'" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                            <div class="card-body text-center p-4">
                                <i class="bi bi-gear" style="font-size: 3rem; color: #667eea;"></i>
                                <h5 class="mt-3">Configura√ß√µes Financeiras</h5>
                                <p class="text-muted small">Regime IVA, INSS e margens</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card" style="cursor: pointer; transition: all 0.3s;" onclick="window.location.href='gestao-produtos.html'" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                            <div class="card-body text-center p-4">
                                <i class="bi bi-box-seam" style="font-size: 3rem; color: #764ba2;"></i>
                                <h5 class="mt-3">Gest√£o de Produtos</h5>
                                <p class="text-muted small">Produtos e servi√ßos</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card" style="cursor: pointer; transition: all 0.3s;" onclick="window.location.href='teste-categorias.html'" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                            <div class="card-body text-center p-4">
                                <i class="bi bi-tags" style="font-size: 3rem; color: #f093fb;"></i>
                                <h5 class="mt-3">Categorias IVA</h5>
                                <p class="text-muted small">Gest√£o de categorias e taxas</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-4">
                    <i class="bi bi-info-circle"></i> 
                    <strong>Dica:</strong> Configure o regime de IVA antes de cadastrar produtos. 
                    A gest√£o de folha de pagamento est√° dispon√≠vel no painel principal (index.html).
                </div>
            </div>
        </div>
    </div>

    <!-- Modal - Nova Categoria de Produto -->
    <div id="modal-categoria-produto" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-categoria-produto-title">Nova Categoria de Produto</h3>
                <span class="modal-close" onclick="categoriasManager.fecharModal('modal-categoria-produto')">&times;</span>
            </div>
            
            <form id="form-categoria-produto">
                <input type="hidden" name="categoria_id" />
                
                <label for="categoria-nome">Nome da Categoria *</label>
                <input type="text" name="nome" id="categoria-nome" placeholder="Ex: Produtos Alimentares" required />
                
                <label for="categoria-descricao">Descri√ß√£o</label>
                <textarea name="descricao" id="categoria-descricao" placeholder="Descri√ß√£o detalhada da categoria" rows="3"></textarea>
                
                <label for="categoria-tipo">Tipo *</label>
                <select name="tipo" id="categoria-tipo" required>
                    <option value="produto">Produto</option>
                    <option value="servico">Servi√ßo</option>
                </select>
                
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="sujeito_iva" id="categoria-sujeito-iva" checked />
                        Sujeito a IVA
                    </label>
                </div>
                
                <label for="categoria-taxa-iva">Taxa de IVA (%)</label>
                <input type="number" name="taxa_iva_padrao" id="categoria-taxa-iva" 
                       min="0" max="100" step="0.01" value="14" placeholder="14.00" />
                
                <div class="iva-examples">
                    <small>
                        <strong>Exemplos:</strong><br>
                        ‚Ä¢ 0% - Produtos alimentares b√°sicos, medicamentos<br>
                        ‚Ä¢ 7% - Produtos alimentares gerais, bebidas<br>
                        ‚Ä¢ 14% - Demais produtos e servi√ßos
                    </small>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-primary" onclick="salvarCategoriaProdutoDirecto()">Salvar</button>
                    <button type="button" class="btn-secondary" onclick="categoriasManager.fecharModal('modal-categoria-produto')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal - Nova Categoria de Despesa -->
    <div id="modal-categoria-despesa" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-categoria-despesa-title">Nova Categoria de Despesa</h3>
                <span class="modal-close" onclick="categoriasManager.fecharModal('modal-categoria-despesa')">&times;</span>
            </div>
            
            <form id="form-categoria-despesa">
                <input type="hidden" name="categoria_id" />
                
                <label for="despesa-nome">Nome da Categoria *</label>
                <input type="text" name="nome" id="despesa-nome" placeholder="Ex: Sal√°rios e Encargos" required />
                
                <label for="despesa-descricao">Descri√ß√£o</label>
                <textarea name="descricao" id="despesa-descricao" placeholder="Descri√ß√£o detalhada da categoria" rows="3"></textarea>
                
                <label for="despesa-codigo-fiscal">C√≥digo Fiscal</label>
                <input type="text" name="codigo_fiscal" id="despesa-codigo-fiscal" placeholder="Ex: SAL001" />
                
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="dedutivel_irt" id="despesa-dedutivel-irt" checked />
                        Dedut√≠vel no IRT
                    </label>
                </div>
                
                <div class="info-box">
                    <small>
                        <strong>Dedut√≠veis IRT:</strong> Sal√°rios, aluguel, energia, material de escrit√≥rio<br>
                        <strong>N√£o Dedut√≠veis:</strong> Despesas pessoais, alguns impostos
                    </small>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-primary" onclick="salvarCategoriaDespesaDirecto()">Salvar</button>
                    <button type="button" class="btn-secondary" onclick="categoriasManager.fecharModal('modal-categoria-despesa')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        AssetLoader.loadScript(
            'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js',
            'vendor/bootstrap/bootstrap.bundle.min.js'
        );
    </script>
    <script src="js/auth.js"></script>
    <script src="js/categorias.js"></script>
    <script src="js/offline-charts.js"></script>
    <script src="app.js"></script>
</body>
</html>
